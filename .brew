fancy_echo() {
  local fmt="$1"; shift

  # shellcheck disable=SC2059
  printf "\n$fmt\n" "$@"
}

brew_install_or_upgrade() {
  if brew_is_installed "$1"; then
    if brew_is_upgradable "$1"; then
      fancy_echo "Upgrading %s ..." "$1"
      brew upgrade "$@"
    else
      fancy_echo "Already using the latest version of %s. Skipping ..." "$1"
    fi
  else
    fancy_echo "Installing %s ..." "$1"
    brew install "$@"
  fi
}

brew_is_installed() {
  local name="$(brew_expand_alias "$1")"

  brew list -1 | grep -Fqx "$name"
}

brew_is_upgradable() {
  local name="$(brew_expand_alias "$1")"

  ! brew outdated --quiet "$name" >/dev/null
}

brew_tap() {
  brew tap "$1" 2> /dev/null
}

brew_expand_alias() {
  brew info "$1" 2>/dev/null | head -1 | awk '{gsub(/:/, ""); print $1}'
}

brew_tap 'caskroom/cask'
brew_tap 'caskroom/versions'
brew_tap 'homebrew/brewdler'
brew_tap 'homebrew/dupes'
brew_tap 'homebrew/games'
brew_tap 'homebrew/versions'
brew_tap 'homebrew/x11'
brew_tap 'thoughtbot/formulae'

brew_install_or_upgrade 'ack'
brew_install_or_upgrade 'android-sdk'
brew_install_or_upgrade 'apple-gcc42'
brew_install_or_upgrade 'autoconf'
brew_install_or_upgrade 'automake'
brew_install_or_upgrade 'bash'
brew_install_or_upgrade 'bash-completion'
brew_install_or_upgrade 'brew-cask'
brew_install_or_upgrade 'cabal-install'
brew_install_or_upgrade 'cask'
brew_install_or_upgrade 'cloog'
brew_install_or_upgrade 'cmake'
brew_install_or_upgrade 'cntlm'
brew_install_or_upgrade 'coreutils'
brew_install_or_upgrade 'cscope'
brew_install_or_upgrade 'ctags'
brew_install_or_upgrade 'docker'
brew_install_or_upgrade 'elasticsearch'
brew_install_or_upgrade 'emacs'
brew_install_or_upgrade 'erlang'
brew_install_or_upgrade 'ffmpeg'
brew_install_or_upgrade 'fig'
brew_install_or_upgrade 'findutils'
brew_install_or_upgrade 'foremost'
brew_install_or_upgrade 'freetype'
brew_install_or_upgrade 'gcc'
brew_install_or_upgrade 'gdbm'
brew_install_or_upgrade 'gettext'
brew_install_or_upgrade 'ghc'
brew_install_or_upgrade 'gist'
brew_install_or_upgrade 'git'
brew_install_or_upgrade 'git-extras'
brew_install_or_upgrade 'gmp'
brew_install_or_upgrade 'gnu-sed', args: ['default-names']
brew_install_or_upgrade 'go'
brew_install_or_upgrade 'grep'
brew_install_or_upgrade 'hub'
brew_install_or_upgrade 'imagemagick'
brew_install_or_upgrade 'isl'
brew_install_or_upgrade 'jpeg'
brew_install_or_upgrade 'lame'
brew_install_or_upgrade 'lesstif'
brew_install_or_upgrade 'libevent'
brew_install_or_upgrade 'libgpg-error'
brew_install_or_upgrade 'libiconv'
brew_install_or_upgrade 'libksba'
brew_install_or_upgrade 'libmpc'
brew_install_or_upgrade 'libogg'
brew_install_or_upgrade 'libpng'
brew_install_or_upgrade 'libtiff'
brew_install_or_upgrade 'libtool'
brew_install_or_upgrade 'libvo-aacenc'
brew_install_or_upgrade 'libvorbis'
brew_install_or_upgrade 'libxml2'
brew_install_or_upgrade 'libyaml'
brew_install_or_upgrade 'lua'
brew_install_or_upgrade 'luajit'
brew_install_or_upgrade 'lynx'
brew_install_or_upgrade 'maven'
brew_install_or_upgrade 'mercurial'
brew_install_or_upgrade 'moreutils'
brew_install_or_upgrade 'mpfr'
brew_install_or_upgrade 'mysql'
brew_install_or_upgrade 'narwhal'
brew_install_or_upgrade 'ncurses'
brew_install_or_upgrade 'ngrep'
brew_install_or_upgrade 'nmap'
brew_install_or_upgrade 'node', args: ['without-npm']
brew_install_or_upgrade 'nvm'
brew_install_or_upgrade 'openssl'
brew_install_or_upgrade 'ossp-uuid'
brew_install_or_upgrade 'p7zip'
brew_install_or_upgrade 'pcre'
brew_install_or_upgrade 'phantomjs'
brew_install_or_upgrade 'pigz'
brew_install_or_upgrade 'pkg-config'
brew_install_or_upgrade 'postgresql'
brew_install_or_upgrade 'pv'
brew_install_or_upgrade 'qt'
brew_install_or_upgrade 'rbenv'
brew_install_or_upgrade 'rbenv-gem-rehash'
brew_install_or_upgrade 'rcm'
brew_install_or_upgrade 'readline'
brew_install_or_upgrade 'reattach-to-user-namespace'
brew_install_or_upgrade 'redis'
brew_install_or_upgrade 'rename'
brew_install_or_upgrade 'rhino'
brew_install_or_upgrade 'ringojs'
brew_install_or_upgrade 'rpm2cpio'
brew_install_or_upgrade 'ruby-build'
brew_install_or_upgrade 'screen'
brew_install_or_upgrade 'sdl2'
brew_install_or_upgrade 'shellcheck'
brew_install_or_upgrade 'sqlite'
brew_install_or_upgrade 'sqlmap'
brew_install_or_upgrade 'ssh-copy-id'
brew_install_or_upgrade 'stow'
brew_install_or_upgrade 'subversion'
brew_install_or_upgrade 'the_silver_searcher'
brew_install_or_upgrade 'terraform'
brew_install_or_upgrade 'tmux'
brew_install_or_upgrade 'tree'
brew_install_or_upgrade 'ucspi-tcp'
brew_install_or_upgrade 'uncrustify'
brew_install_or_upgrade 'unixodbc'
brew_install_or_upgrade 'v8'
brew_install_or_upgrade 'vim'
brew_install_or_upgrade 'watch'
brew_install_or_upgrade 'webkit2png'
brew_install_or_upgrade 'wget' --enable-iri
brew_install_or_upgrade 'wxmac'
brew_install_or_upgrade 'x264'
brew_install_or_upgrade 'xpdf'
brew_install_or_upgrade 'xvid'
brew_install_or_upgrade 'xz'
brew_install_or_upgrade 'zopfli'

# Common Casks
brew install cask 'atom'
brew install cask 'consul'
brew install cask 'dropbox'
brew install cask 'google-chrome'
brew install cask 'transmission'
brew install cask 'vagrant'
brew install cask 'virtualbox'
brew install cask 'vlc'

if [[ "$OSTYPE" =~ darwin ]]; then
  # OSX Casks
  brew install cask '1password'
  brew install cask 'charles'
  brew install cask 'chicken'
  brew install cask 'cleanmymac'
  brew install cask 'coconutbattery'
  brew install cask 'growlnotify'
  brew install cask 'iterm2'
  brew install cask 'kdiff3'
  brew install cask 'qt-creator'
  brew install cask 'reggy'
  brew install cask 'slate'
  brew install cask 'spotify'
  brew install cask 'the-unarchiver'
elif [[ "$OSTYPE" =~ linux-gnu ]]; then
  # Linux Casks
  brew install cask 'terminator'
fi
